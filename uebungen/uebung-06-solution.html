<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.5.57">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>uebung-06-solution</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="uebung-06-solution_files/libs/clipboard/clipboard.min.js"></script>
<script src="uebung-06-solution_files/libs/quarto-html/quarto.js"></script>
<script src="uebung-06-solution_files/libs/quarto-html/popper.min.js"></script>
<script src="uebung-06-solution_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="uebung-06-solution_files/libs/quarto-html/anchor.min.js"></script>
<link href="uebung-06-solution_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="uebung-06-solution_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="uebung-06-solution_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="uebung-06-solution_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="uebung-06-solution_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">

  <script src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">




<section id="sec-uebung-06" class="level1 unnumbered">
<h1 class="unnumbered">Übung 6</h1>
<div class="callout callout-style-default callout-note callout-titled" title="Lernziele dieser Übung">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Lernziele dieser Übung
</div>
</div>
<div class="callout-body-container callout-body">
<p>Nach der heutigen Übung können Sie:</p>
<ul>
<li><p><em>R</em> und <em>RStudio</em> zur Analyse von Daten verwenden</p></li>
<li><p>einfaktorielle Varianzanalysen ohne Messwiederholung in <em>R</em> durchführen</p>
<ul>
<li>Hypothesen zum Vergleich von mehr als zwei Stichprobenmittelwerten von unabhängigen Gruppen durchführen</li>
<li>Voraussetzungen überprüfen</li>
<li>Test berechnen</li>
<li>Resultate interpretieren</li>
<li>Post-hoc Paarvergleiche und Kontrastanalysen berechnen</li>
</ul></li>
</ul>
<p>Diese Übung ist eine Weiterführung von <a href="uebung-5.qmd">Übung 5</a>. Absolvieren Sie zuerst Übung 5, bevor Sie hier weiterarbeiten.</p>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled" title="Voraussetzungen">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Voraussetzungen
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>Packages {tidyverse}, {afex}, {emmeans}, {beeswarm}, {effectsize} sind installiert.</p></li>
<li><p>Projekt und Datensatz aus Übung 5 wurden heruntergeladen.</p></li>
<li><p>Übung 5 wurde gelöst.</p></li>
</ol>
</div>
</div>
<p><br></p>
<section id="aufgabe-6.0-projektumgebung-erstellen" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-6.0-projektumgebung-erstellen">Aufgabe 6.0: Projektumgebung erstellen</h2>
<p><em>Falls obige Anforderungen noch nicht erfüllt:</em></p>
<ul>
<li><p>Laden Sie den Projektordner herunter und <strong>entzippen</strong> Sie den Ordner.<a href="#fn1" class="footnote-ref" id="fnref1" role="doc-noteref"><sup>1</sup></a></p>
</li>
<li><p>Installieren Sie die benötigten Packages (falls noch nicht geschehen) unter <code>Tools</code> &gt; <code>Install Packages...</code> oder in der Konsole mit</p>
<p><code>install.packages("afex")</code></p>
<p><code>install.packages("emmeans")</code></p>
<p><code>install.packages("beeswarm")</code></p>
<p><code>install.packages("effectsize")</code></p></li>
</ul>
<p><strong>a.</strong> Öffnen Sie das <em>RProjekt</em> <code>anova</code>.</p>
<p><strong>b.</strong> Erstellen Sie ein <em>RNotebook</em> namens <code>uebung-06</code> oder arbeiten Sie bei <code>uebung-05</code> weiter.</p>
<p><br></p>
</section>
<section id="aufgabe-6.1-einstieg" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-6.1-einstieg">Aufgabe 6.1: Einstieg</h2>
<p><strong>a.</strong> Welche Vermutungen haben Sie bei Aufgabe <strong>5.2.h</strong>? Welche Mittelwerte unterscheiden sich Ihrer Einschätzung nach bedeutsam?</p>
<blockquote class="blockquote">
<p>z.B. Instrumental &gt; Rock/Oper &gt; Schlager</p>
</blockquote>
<p><strong>b.</strong> Wie viele paarweise Mittelwertsvergleiche durch <em>t</em>-Tests sind im Musikexperiment grundsätzlich möglich?</p>
<blockquote class="blockquote">
<p>3*2=6</p>
</blockquote>
<blockquote class="blockquote">
<p><span class="math inline">\(\mu_1 = \mu_2\)</span>, <span class="math inline">\(\mu_1 = \mu_3\)</span>, <span class="math inline">\(\mu_1 = \mu_4\)</span>, <span class="math inline">\(\mu_2 = \mu_3\)</span>, <span class="math inline">\(\mu_2 = \mu_4\)</span>, <span class="math inline">\(\mu_3 = \mu_4\)</span></p>
</blockquote>
<blockquote class="blockquote">
<p>Mit Kontrasten sind aber auch Kombinationen davon möglich.</p>
</blockquote>
<p><strong>c.</strong> Worin besteht das Problem des multiplen Testens?</p>
<blockquote class="blockquote">
<p>Bei multiplen Mittelwertvergleichen kumuliert sich der <span class="math inline">\(\alpha\)</span>-Fehler. Man spricht deshalb auch von einer Inflation des Fehlers 1. Art. Wenn die Nullhypothese gilt, wird jeder Test mit einer Wahrscheinlichkeit <span class="math inline">\(\alpha\)</span> signifikant, somit steigt mit jedem zusätzlichen Test die Wahrscheinlichkeit, dass der Test rein zufällig signifikant wird, weil <span class="math inline">\(\alpha\)</span> kumuliert wird. z.B. bei 6 Einzelvergleichen mit der gleichen Stichprobe, würde die Nullhypothese ohne Korrektur bereits bei 0.265 verworfen und nicht bei 0.05.</p>
</blockquote>
<blockquote class="blockquote">
<p><span class="math inline">\(s = 3\)</span>, <span class="math inline">\(\alpha_r = 0.05\)</span></p>
</blockquote>
<blockquote class="blockquote">
<p><span class="math inline">\(\alpha_{fam} = 1 - (1 - \alpha_r)^6 = 1 - 0.95^6 = 1 - 0.735 = 0.265\)</span></p>
</blockquote>
</section>
<section id="aufgabe-6.2-post-hoc-vergleiche" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-6.2-post-hoc-vergleiche">Aufgabe 6.2: Post-hoc Vergleiche</h2>
<!-- hier ev. den Code bis und mit Anova drin lassen, damits schneller geht -->
<p><strong>a.</strong> Anova-Modell berechnen</p>
<ul>
<li>Lesen Sie den Datensatz <code>anova_music.csv</code> ein und konvertieren Sie die Variable <code>id</code> und <code>condition</code> zu einem Faktor (siehe <a href="uebung-05.qmd">Übung 5</a>). Schauen Sie sich den Datensatz kurz mit <code>glimpse()</code> an.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tidyverse laden</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Datensatz einlesen</span></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>d_music <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="st">"data/anova_music.csv"</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="co"># Faktoren konvertieren</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>d_music <span class="ot">&lt;-</span> d_music <span class="sc">|&gt;</span></span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">as.factor</span>(id)) <span class="sc">|&gt;</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">condition =</span> <span class="fu">as.factor</span>(condition))</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a><span class="co"># Datensatz anschauen</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(d_music)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 80
Columns: 3
$ id        &lt;fct&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17, 1…
$ condition &lt;fct&gt; instrumental, instrumental, instrumental, instrumental, inst…
$ testscore &lt;int&gt; 16, 15, 20, 25, 28, 20, 18, 24, 30, 25, 19, 20, 24, 31, 28, …</code></pre>
</div>
</div>
<ul>
<li>Berechnen Sie das Anova-Modell <code>m_anova1</code> (siehe <a href="uebung-05.qmd">Übung 5</a>).</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="co"># afex laden</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(afex)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'afex' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Einfaktorielle Anova </span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a>m_anova1 <span class="ot">&lt;-</span> <span class="fu">aov_4</span>(testscore <span class="sc">~</span> condition <span class="sc">+</span> (<span class="dv">1</span> <span class="sc">|</span> id), </span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>                <span class="at">data =</span> d_music) </span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultate ausgeben</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(m_anova1) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type 3 tests)

Response: testscore
          num Df den Df    MSE      F     ges    Pr(&gt;F)    
condition      3     76 18.343 36.406 0.58967 1.083e-14 ***
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>m_anova1<span class="sc">$</span>Anova</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Anova Table (Type III tests)

Response: dv
             Sum Sq Df  F value    Pr(&gt;F)    
(Intercept) 19406.5  1 1057.951 &lt; 2.2e-16 ***
condition    2003.4  3   36.406 1.083e-14 ***
Residuals    1394.1 76                       
---
Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1</code></pre>
</div>
</div>
<ul>
<li>Erstellen Sie mit der Funktion <code>emmeans()</code> aus dem Package {emmeans} ein Objekt, z.B. <code>m_anova1_results</code>. Darin werden die “Estimated Marginal Means” gespeichert.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Package emmeans laden</span></span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultate (estimated marginal means) speichern</span></span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>m_anova1_result <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(<span class="at">object =</span> ____, <span class="at">specs =</span> <span class="sc">~</span> ____) <span class="co"># object = anova modell, ~ uv</span></span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>m_anova1_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Package emmeans laden</span></span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(emmeans)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'emmeans' was built under R version 4.4.3</code></pre>
</div>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Resultate (estimated marginal means) speichern</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a>m_anova1_result <span class="ot">&lt;-</span> <span class="fu">emmeans</span>(<span class="at">object =</span> m_anova1, <span class="at">specs =</span> <span class="sc">~</span> condition) <span class="co"># object = anova modell, ~ uv</span></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a>m_anova1_result</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> condition    emmean    SE df lower.CL upper.CL
 instrumental   23.2 0.958 76    21.34     25.2
 oper           14.2 0.958 76    12.29     16.1
 rock           15.6 0.958 76    13.64     17.5
 schlager        9.3 0.958 76     7.39     11.2

Confidence level used: 0.95 </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Hier können Mittelwerte abgelesen werden.</p>
</blockquote>
<ul>
<li>Lassen Sie sich mit der Funktion <code>pairs(x = model, adjust = "none")</code> zuerst alle Paarvergleiche ausgeben, ohne dass eine Korrektur vorgenommen wird. Zu Übungszwecken können Sie die korrigierten Resultate mit den unkorrigierten vergleichen.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc ohne Adjustierung</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  0.3220
 oper - schlager             4.90 1.35 76   3.618  0.0005
 rock - schlager             6.25 1.35 76   4.615  &lt;.0001</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Ohne Adjustierung sind alle ausser “oper-rock” signifikant unterschiedlich. So aber nicht zulässig (Multiples Testen).</p>
</blockquote>
<p><strong>b.</strong> Überprüfen Sie mit dem Tukey-Test alle Paarvergleiche gleichzeitig.</p>
<ul>
<li>Welche Voraussetzungen erfordert der Tukey-Test?</li>
</ul>
<blockquote class="blockquote">
<p>Der Tukey-Test setzt voraus, dass für alle <em>J</em> Bedingungen gleiche Stichprobengrössen vorliegen. Bei unbalancierten Stichproben wird der Tukey-Kramer-Test oder der Scheffé-Test verwendet. Nur die Tukey-Adjustierung ist eigentlich für einen vollständigen Paarvergleich aller Bedingungen wie hier geeignet. Die anderen Adjustierungsmethoden sollten vorzugsweise für ein Subset von Bedingungsvergleichen benutzt werden. Diese müssten dann zuerst als ein Set von Kontrasten definiert werden.</p>
</blockquote>
<ul>
<li>Welchen Vorteil hat der Tukey-Test gegenüber der Bonferroni-Korrektur?</li>
</ul>
<blockquote class="blockquote">
<p>Bei Gültigkeit der statistischen Voraussetzungen hat der Tukey-Test eine grössere Power als Tests auf der Basis der Bonferroni-Korrektur, wenn alle Mittelwerte miteinander verglichen werden (Maxwell &amp; Delaney, 2004).</p>
</blockquote>
<ul>
<li>Welche Prüfgrösse gibt der Tukey-Test aus?</li>
</ul>
<blockquote class="blockquote">
<p>t.ratio (add comment, formel siehe VL6)</p>
</blockquote>
<ul>
<li>Führen Sie den Post-hoc-Vergleich für alle möglichen Mittelwertspaare mit <code>adjust = "tukey"</code> durch. Wie lautet Ihre Testentscheidung?</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc mit dem Tukey-Test</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"tukey"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  0.7517
 oper - schlager             4.90 1.35 76   3.618  0.0029
 rock - schlager             6.25 1.35 76   4.615  0.0001

P value adjustment: tukey method for comparing a family of 4 estimates </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Der Tukey-Test wird verwendet, wenn alle möglichen Mittelwertspaare verglichen werden sollen.</p>
</blockquote>
<blockquote class="blockquote">
<p>Interpretation: Die paarweise Mittelwertsdifferenzen unterscheiden sich signifikant von 0, ausser die Differenz Rock - Oper.</p>
</blockquote>
<blockquote class="blockquote">
<p>Im Vergleich zu den p-Werten ohne Korrektur: Die p-Werte sind ohne Korrektur kleiner, d.h. deuten eher darauf hin, dass die Nullhypothese abgelehnt wird, da unter der Nullhypothese kleine p-Werte (grosse t-Werte) unwahrscheinlich sind.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc ohne Korrektur</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"none"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  0.3220
 oper - schlager             4.90 1.35 76   3.618  0.0005
 rock - schlager             6.25 1.35 76   4.615  &lt;.0001</code></pre>
</div>
</div>
<p><strong>c.</strong> Als eine weitere Möglichkeit wollen Sie a-priori (also vorher) festgelegte Hypothesen prüfen. Dabei ist es wichtig, vorher festzulegen, welche Mittelwertsvergleiche untersucht werden sollen.</p>
<p>Prüfen Sie mit der Bonferroni-Holm-Methode, welche Bedingungsmittelwerte sich signifikant unterscheiden.</p>
<ul>
<li>Wie funktioniert die Bonferroni-Holm-Methode?</li>
</ul>
<blockquote class="blockquote">
<p>Aufsteigende Sortierung der p-Werte (bzw. auch an t-Werte möglich). Jeder p-Wert wird dann mit spezifisch adjustiertem p-Wert verglichen (schrittweise). Dies wird solange fortgesetzt, bis der erste p-Wert nicht mehr signifikant ist. Ab dann alle weiteren <span class="math inline">\(H_0\)</span> nicht mehr ablehnen.</p>
</blockquote>
<ul>
<li>Welchen Vorteil hat sie gegenüber der Bonferroni-Methode?</li>
</ul>
<blockquote class="blockquote">
<p>Mehr Power, da schrittweises Testen.</p>
</blockquote>
<ul>
<li>Führen Sie den Post-hoc-Vergleich mit <code>adjust = "holm"</code> durch. Wie lautet Ihre Testentscheidung? Vergleichen Sie die <span class="math inline">\(p\)</span>-Werte mit den unkorrigierten Werten.</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc-Vergleiche mit der Bonferroni-Holm-Methode</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"holm"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  0.3220
 oper - schlager             4.90 1.35 76   3.618  0.0011
 rock - schlager             6.25 1.35 76   4.615  &lt;.0001

P value adjustment: holm method for 6 tests </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Die BHM passt das Signifikanzniveau schrittweise an. Daher kontrolliert die Methode den Fehler 1. Art (family-wise error rate), hat aber gleichzeitig mehr Power als die klassische Bonferroni-Methode.</p>
</blockquote>
<blockquote class="blockquote">
<p>Hier wird der Vergleich mit dem kleinsten t-Wert zum Schluss auf dem 0.05-Alphaniveau getestet, die vorherigen Vergleiche werden auf einem korrigierten Alphaniveau getestet. Dies ist hier nicht wirklich ersichtlich, da der zweitletze Vergleich (oper- schlager) auf dem 0.025 Niveau getestet wird und daher auch signifikant wird. Man sieht jedoch, dass der zweitgrösste <span class="math inline">\(p\)</span>-Wert mit <span class="math inline">\(\cdot 2\)</span> adjustiert wurde (<span class="math inline">\(0.0005 \cdot 2 = 0.0011\)</span>).</p>
</blockquote>
<ul>
<li>Falls ein unbalanciertes Design vorliegt, kann die Bonferroni-Holm-Methode nicht verwendet werden. Überprüfen Sie die Paarvergleiche daher auch mit dem Scheffé-Test mit <code>adjust = "scheffe"</code>. Was fällt Ihnen auf?</li>
</ul>
<blockquote class="blockquote">
<p>Scheffé-Test bei unbalancierten Designs sinnvoll, da recht streng/konversativ, lehnt Nullhypothese nicht schnell ab</p>
</blockquote>
<blockquote class="blockquote">
<p>Mit diesem Test wird der gesamte, mit allen möglichen Einzelvergleichen verbundene Hypothesenkomplex der Varianzanalyse auf dem festgelegten Niveau eines Fehlers 1. Art abgesichert.</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc-Vergleiche mit dem Scheffé-Test z.B. bei unbalancierten Daten</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"scheffe"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  0.8028
 oper - schlager             4.90 1.35 76   3.618  0.0069
 rock - schlager             6.25 1.35 76   4.615  0.0003

P value adjustment: scheffe method with rank 3 </code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>p-Werte sind höher, d.h. die Wahrscheinlichkeit, dass die Nullhypothese abgelehnt wird, ist kleiner. Der Scheffé-Test ist tendenziell eher konservativ (d.&nbsp;h. entscheidet zugunsten der H0).</p>
</blockquote>
<blockquote class="blockquote">
<p>Weitere Varianten</p>
</blockquote>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc-Vergleiche mit Adjustierung</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"sidak"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  0.9029
 oper - schlager             4.90 1.35 76   3.618  0.0032
 rock - schlager             6.25 1.35 76   4.615  0.0001

P value adjustment: sidak method for 6 tests </code></pre>
</div>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Post-hoc-Vergleiche mit Bonferroni</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(<span class="at">x =</span> m_anova1_result, <span class="at">adjust =</span> <span class="st">"bonferroni"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                estimate   SE df t.ratio p.value
 instrumental - oper         9.05 1.35 76   6.682  &lt;.0001
 instrumental - rock         7.70 1.35 76   5.685  &lt;.0001
 instrumental - schlager    13.95 1.35 76  10.300  &lt;.0001
 oper - rock                -1.35 1.35 76  -0.997  1.0000
 oper - schlager             4.90 1.35 76   3.618  0.0032
 rock - schlager             6.25 1.35 76   4.615  0.0001

P value adjustment: bonferroni method for 6 tests </code></pre>
</div>
</div>
</section>
<section id="aufgabe-6.3-kontrastanalysen" class="level2">
<h2 class="anchored" data-anchor-id="aufgabe-6.3-kontrastanalysen">Aufgabe 6.3: Kontrastanalysen</h2>
<p><strong>a.</strong> Schauen Sie sich mit der Funktion <code>levels()</code> im Datensatz an in welcher Reihenfolge die Stufen des Faktors <code>condition</code> geordnet sind:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">levels</span>(d_music<span class="sc">$</span>condition)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "instrumental" "oper"         "rock"         "schlager"    </code></pre>
</div>
</div>
<p><strong>b.</strong> Kontrastanalysen erfordern das Definieren von Kontrasten. Definieren Sie die Kontraste für folgende Hypothesen und benennen Sie den Kontrast. Wichtig: Ein Kontrast in dieser Aufgabe besteht aus 4 Werten. In der Summe ergeben die Werte eines Kontrastes 0.</p>
<ul>
<li>“Die kognitive Leistung unter Opernmusik ist höher als in den drei anderen Bedingungen.”</li>
</ul>
<blockquote class="blockquote">
<p>Kontrast “oper - rest” : -1 3 -1 -1</p>
</blockquote>
<ul>
<li>“Die kognitive Leistung unter Schlagermusik ist besser als unter Rockmusik.”</li>
</ul>
<blockquote class="blockquote">
<p>Kontrast “schlager - rock” : 0 0 -1 1</p>
</blockquote>
<ul>
<li>“Die kognitive Leistung ist besser unter Rockmusik im Vergleich zu den drei anderen Musikarten.”</li>
</ul>
<blockquote class="blockquote">
<p>Kontrast “instrumental - rest” : -1 -1 3 -1</p>
</blockquote>
<p><strong>c.</strong> Wir wollen nun die Hypothese überprüfen, dass die Konzentrationsleistung von Personen unter dem Einfluss klassischer Instrumentalmusik (Bedingung 1) <strong>höher</strong> ist als unter dem Einfluss von Opernmusik (Bedingung 2), von Rockmusik (Bedingung 3) oder von Schlagermusik (Bedingung 4).</p>
<p>Überprüfen Sie mit Hilfe eines Kontrasts die Hypothese, dass die kognitive Leistung in der Instrumentalbedingung höher ist als der Durchschnitt der kognitiven Leistung in den drei anderen Musikbedingungen.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrastanalyse</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="do">## H: Instrumental unterscheidet sich von anderen Bedingungen</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>m_anova1_contrast1 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"instrumental - rest"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">3</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)) <span class="co"># Kontrast definieren</span></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(<span class="at">object =</span> m_anova1_result, <span class="at">method =</span> m_anova1_contrast1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast            estimate   SE df t.ratio p.value
 instrumental - rest     30.7 3.32 76   9.254  &lt;.0001</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p>Test auf Abweichung einer Bedingung vom Durchschnitt der anderen Bedingungen (=Helmert Kontrast)</p>
</blockquote>
<blockquote class="blockquote">
<p>3, -1, -1, -1 (oder mathematisch äquivalente Lösungen, aber sinnvoll ist, dass die interessierende Bedingung gemäss Hypothese positiven Wert hat, d.h. 3)</p>
</blockquote>
<blockquote class="blockquote">
<p>gerichtete Hypothese: der <span class="math inline">\(p\)</span>-Wert muss dadurch halbiert werden (einseitig testen) –&gt; <span class="math inline">\(p &lt; .001\)</span> (macht hier keinen Unterschied zu ungerichtet, da hoch signifikant)</p>
</blockquote>
<p><strong>b.</strong> Überprüfen Sie nun eine andere Hypothese, die besagt, dass sich moderne Pop- und Rocksongs (inkl. Schlager) von anderen Musikarten wie Instrumentalmusik und Oper in ihrem Effekt auf die kognitive Leistung unterscheiden (d.h. Instrumental &amp; Oper versus Schlager &amp; Rock).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Kontrastanalyse</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="do">## H: Instrumental/Oper unterscheidet sich von Rock/Schlager</span></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>m_anova1_contrast2 <span class="ot">&lt;-</span> <span class="fu">list</span>(<span class="st">"instrumental/oper - rock/schlager"</span> <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>, <span class="dv">1</span>, <span class="sc">-</span><span class="dv">1</span>)) <span class="co"># Kontrast definieren</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a><span class="fu">contrast</span>(<span class="at">object =</span> m_anova1_result, <span class="at">method =</span> m_anova1_contrast2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> contrast                          estimate   SE df t.ratio p.value
 instrumental/oper - rock/schlager     15.3 1.92 76   7.988  &lt;.0001</code></pre>
</div>
</div>
<p><strong>c.</strong> Was passiert, wenn man mehrere Kontraste berechnet?</p>
<blockquote class="blockquote">
<p>Je mehr Kontraste überprüft werden, umso stärker steigt der <span class="math inline">\(\alpha_{fam}\)</span>-Fehler für eine Familie von Kontrasten an. Es ist daher wichtig und sinnvoll, dass die Kontraste vorher definiert werden und ADD.</p>
</blockquote>
</section>
<section id="zusatzaufgabe" class="level2">
<h2 class="anchored" data-anchor-id="zusatzaufgabe">Zusatzaufgabe</h2>
<div class="callout callout-style-default callout-tip callout-titled" title="Zusatzaufgaben">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Zusatzaufgaben
</div>
</div>
<div class="callout-body-container callout-body">
<p><strong>Zusatzaufgaben müssen nicht gelöst werden.</strong></p>
</div>
</div>
<p><strong>a.</strong> Erstellen Sie eine Grafik des Datensatzes <code>d_music</code> der die durchschnittliche Leistung in allen vier Bedingungen miteinander vergleicht, mit <code>condition</code> und <code>testscore</code> auf den beiden Achsen. Hierfür eignet sich beispielsweise ein Boxplot.</p>
<p><strong>Schwer:</strong></p>
<p><strong>b.</strong> Erstellen Sie eine Grafik, die Mittelwerte und Standardabweichung jeder Bedingung miteinander vergleicht.</p>
<p><strong>c.</strong> Erstellen Sie eine Grafik, die die oben berechneten Kontraste miteinander vergleicht.</p>
</section>
</section>


<div id="quarto-appendix" class="default"><section id="footnotes" class="footnotes footnotes-end-of-document" role="doc-endnotes"><h2 class="anchored quarto-appendix-heading">Footnotes</h2>

<ol>
<li id="fn1"><p>Für das Entzippen mit <em>Windows</em> machen Sie einen Rechtsklick auf den Ordner mit dem Reissverschluss und wählen Sie <code>Entpacken nach</code> und geben Sie den Ordner an, in dem Sie alle Ihre <em>RProject-Ordner</em> speichern. Für das Entzippen mit <em>Mac</em> speichern Sie den heruntergeladenen Ordner in den Ordner, in dem Sie alle Ihre <em>RProject-Ordner</em> speichern und Doppelklicken Sie danach auf den Ordner. Nur entzippte Ordner können einwandfrei verwendet werden.<a href="#fnref1" class="footnote-back" role="doc-backlink">↩︎</a></p></li>
</ol>
</section></div></main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    // For code content inside modals, clipBoardJS needs to be initialized with a container option
    // TODO: Check when it could be a function (https://github.com/zenorocha/clipboard.js/issues/860)
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>